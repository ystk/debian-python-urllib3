From 6245ddddb7f80740c5c15e1750e5b9f68c5b2b5f Mon Sep 17 00:00:00 2001
From: "Seth M. Larson" <SethMichaelLarson@users.noreply.github.com>
Date: Tue, 27 Mar 2018 13:14:11 -0500
Subject: [PATCH] Stop using headers, instead use kw['headers']

---
 urllib3/poolmanager.py |    8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

--- a/urllib3/poolmanager.py
+++ b/urllib3/poolmanager.py
@@ -146,9 +146,7 @@ class PoolManager(RequestMethods):
         kw['redirect'] = False
 
         if 'headers' not in kw:
-            kw['headers'] = headers = self.headers
-        else:
-            headers = kw['headers']
+            kw['headers'] = self.headers.copy()
 
         if self.proxy is not None and u.scheme == "http":
             response = conn.urlopen(method, url, **kw)
@@ -174,12 +172,10 @@ class PoolManager(RequestMethods):
         if (retries.remove_headers_on_redirect
                 and not conn.is_same_host(redirect_location)):
             for header in retries.remove_headers_on_redirect:
-                if header in headers:
-                    headers.pop(header)
+                kw['headers'].pop(header, None)
 
         kw['retries'] = retries.increment(method, redirect_location)
         kw['redirect'] = redirect
-        kw['headers'] = headers
 
         log.info("Redirecting %s -> %s" % (url, redirect_location))
         return self.urlopen(method, redirect_location, **kw)
